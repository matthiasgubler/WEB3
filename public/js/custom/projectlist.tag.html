<projectlist>
    <section id="projects">
        <fieldset>
            <legend class="rainbow2">Projects :-)</legend>
            <div class="form-group">
                <label for="projectsList">Projects:</label>
                <select class="form-control" id="projectsList" ref="project" onchange="{ projectChange }">
                    <option each="{ project in allProjects() }" value="{ project.identifier }">{ project.title }
                    </option>
                </select>
            </div>
            <input id="inputnewproject" type="text" class="form-control" name="inputnewproject" ref="newproject"
                   placeholder="new project...">
            <button onclick="{ addProject }">Create Project</button>
            <script>
                var tag = this;
                tag.projects = new ProjectCollection(this);
                tag.allProjects = function () {
                    return tag.projects.get();
                }

                this.on("mount", function () {
                    tag.projects.loadProjectCollection();
                    console.log(tag.projects);
                    let selectedProject = tag.projects.loadSelectedProject();
                    if (selectedProject != null) {
                        this.refs.project.value = selectedProject.identifier;
                    }

                    this.projectChange();
                    tag.update();
                });

                projectChange(e)
                {
                    let selectedProject = tag.projects.getByIdentifier(this.refs.project.value);
                    tag.projects.setSelectedProject(selectedProject);
                    tag.bus.trigger('projectChange', selectedProject);


                    if (e) {
                        e.preventDefault();
                    }

                }

                addProject(e)
                {
                    let newProject = new Project(this.refs.newproject.value);
                    tag.projects.add(newProject);
                    tag.update();
                    this.refs.project.value = newProject.identifier;
                    this.refs.newproject.value = "";
                    tag.projects.selected = newProject;

                    tag.projects.setSelectedProject(newProject);
                    tag.bus.trigger('projectChange', newProject);

                    tag.projects.storeProjectCollection();
                    if (e) {
                        e.preventDefault()
                    }
                }

                this.bus.on('updatedIssues', function (issues) {
                    tag.projects.selected.issueCollection = issues;
                    tag.projects.storeProjectCollection();
                });

            </script>
        </fieldset>
    </section>
</projectlist>